# Kubernetes 安全相关

## K8s中的认证和授权机制

**API Server认证授权过程:**
subject(主体)----->认证----->授权【action(可做什么)】------>运行时刻的admission准入控制【Object(能对那些资源对象做操作)】

在K8s中我们操作任何资源都需要经历三个检查步骤：`认证、授权 和 准入控制`。当然这些仅针对普通用户，`k8s中默认clusteradmin是拥有最高权限的。`

- 认证: 即用户要登陆k8s上操作资源，你必须提供合法的用户名和密码。
- 授权: 用户认证通过后，要查看该用户能操作什么资源，若其要操作的资源在其允许操作的资源范围内则通过。
- 准入控制: 用户要操作的资源，也许需要级联其它相关资源或级联了其它相关操作，那么这些级联的资源 或 级联的操作该用户是否有权限访问？这个就是有准入控制来检查的，若不允许访问级联资源，那么该资源也将无法访问。
  
因为k8s是高度模块化设计，因此，这三种检查都允许用户自定义使用何种检测机制来进行访问控制。

### 认证

- token: 此方式又称为预共享密钥方式的认证，即用户名和密码，如同MySQL中root要登陆，必须事先在user表中创建root密码.

- TLS: 此中方式为证书认证方式，此时K8s服务端 和 客户端要做双向证书认证，即客户端要认证服务端的证书是否为自己认可的CA所签发的证书，且证书中的subject信息CN(主机名)必须与服务端的主机名一致，等等；而服务器端也要认证客户端的证书，也要认可签发该证书的CA，以及证书中的信息也要匹配。

以上是两种比较常用的认证方式，还有其它认证，可自行研究。需要注意的是 认证插件中只有一个认证通过，其它插件就无需再次认证了。

### 授权

在Kubernetes中，授权有`ABAC（基于属性的访问控制）、RBAC（基于角色的访问控制）、Webhook、Node、AlwaysDeny（一直拒绝）和AlwaysAllow（一直允许）`这6种模式

它也是模块化设计,它和认证一样都同时支持多个模块并存，但只要有一个模块认证通过，即通过了此关，可进入下一关进一步检查。

除了下面几种常用授权模块，我们也可在测试时，使用“总是允许” 或 “总是拒绝”来测试账号。

- RBAC：基于角色的访问控制机制，它只有允许授权，没有拒绝授权，因为默认是拒绝所有，我们仅需要定义允许该用户做什么即可。默认kubectl创建的K8s资源，都是默认启用强制RBAC的

- ABAC: 基于属性的访问控制

- 基于Node的授权

- Web-huke的授权（这是一种通过Web的回调机制实现的授权)

### 准入控制

这块主要是对认证授权通过后，后期对要操作的级联对象操作的检查，无需过多关注
